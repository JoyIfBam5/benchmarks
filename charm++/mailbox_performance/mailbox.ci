
mainmodule mailbox {

  mainchare main {
    entry main(CkArgMsg*);
  };
  
  chare receiver {
    entry receiver(uint64_t max);
    entry void behavior() {
      while(m_value != m_max) {
        when receive()
          atomic {
            ++m_value;
          }
      } 
      atomic {
      CkExit();
      }
    };
    entry void receive();
  };

  chare sender {
    entry sender(CProxy_receiver receiver, uint64_t count); 
  };
};
